"use strict";(self.webpackChunkdenntenna_github_io=self.webpackChunkdenntenna_github_io||[]).push([[1852],{43826:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return d},default:function(){return l}});var n=a(63366),i=(a(67294),a(64983)),o=a(66101),s=["components"],d={},c={_frontmatter:d},r=o.Z;function l(e){var t=e.components,a=(0,n.Z)(e,s);return(0,i.kt)(r,Object.assign({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",null,"Profiling Docker Images"),(0,i.kt)("p",null,"As it happens in the middle of a frantic week of prototyping a nodejs app, I installed a bunch of dependencies and was ready to deploy my app to the cloud. At which point I noticed that the docker build step was taking forever.\nI ran ",(0,i.kt)("inlineCode",{parentName:"p"},"docker image ls")," and saw that my image was 4 GBs in size. Although I wanted to blame it on the random libraries I had installed, the huge size made me think it was a mistake in my .gitignore file and maybe I was adding some images or something into my docker images."),(0,i.kt)("p",null,"I was saved by ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wagoodman/dive"},"dive"),"."),(0,i.kt)("p",null,"Find the ID of the offending docker image."),(0,i.kt)("deckgo-highlight-code",{language:"shell",terminal:"carbon"},"\n          ",(0,i.kt)("code",{parentName:"deckgo-highlight-code",slot:"code"},"docker image ls"),"\n        "),(0,i.kt)("deckgo-highlight-code",{language:"shell",terminal:"carbon"},"\n          ",(0,i.kt)("code",{parentName:"deckgo-highlight-code",slot:"code"},"dive IMAGE_ID"),"\n        "),(0,i.kt)("p",null,"This brings up a tree view of all the files within the various layers of your image."),(0,i.kt)("p",null,(0,i.kt)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1200px"}},"\n      ",(0,i.kt)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/177a87f2d7ae0fcc67c0d41424c92dab/29114/dive-screenshot.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,i.kt)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"56.333333333333336%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVQoz12PW4+aUBRGSTM6KireAMELcDggAp4bB1BuTr1mps3YhybtUx/7/39CozPtdCZZ+bKTb6/sbGHP0NksdvO4HJNKo4WCs9Eqk9F1kMNnUl7w5wvdfufHr6iIux6qm7gBUM3gg1D4sf/y+/HXz+xSTXmukmQQxD0/7vu85/P+spijakYrG+/cZOuhSPJo26Edh7TsVCXCEZY7M60mUamzSo9e4NKStG5LfROJFhmYibyINIOINmlB0oK4ARIZCweYlxrlkkdFh7Zd9j9dh41sJsFIBmvV5xNAJfBOPjrF2SkepnHS93nXe+muNCFtw0iGrAu5AtdqsJl5tH2rxL8y63rbCf+GT3sz/SCzjptpK95bZHpYTkimh1R03l1mkldq9Hm1z1X8ZrYgbtpc8nZGmvSDUmcHkFHRwU37o7wZrZ6WD5mCWdu5fn4Dt2DcW+6MNB2GlR4drE3UWfxrSdNOFSKE91ZYN1EDhHXTv5sHNSOoGWHdDO9NIsJ8TFjXzVRUaPRa3b3if5rRni8cQX6ysvMtTyA/gexs53tjnQ9JpUZnkJcyy4d0q/FHp3wDFk/BQcCIu2ABZsCagdecA0M3FEnV5rq1sMa6pkxUfaojd4lDgnyMfERXdOWhP/XMZp1uxZQcAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,i.kt)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Screenshot of Dive",title:"Screenshot of Dive",src:"/static/177a87f2d7ae0fcc67c0d41424c92dab/c1b63/dive-screenshot.png",srcSet:["/static/177a87f2d7ae0fcc67c0d41424c92dab/5a46d/dive-screenshot.png 300w","/static/177a87f2d7ae0fcc67c0d41424c92dab/0a47e/dive-screenshot.png 600w","/static/177a87f2d7ae0fcc67c0d41424c92dab/c1b63/dive-screenshot.png 1200w","/static/177a87f2d7ae0fcc67c0d41424c92dab/d61c2/dive-screenshot.png 1800w","/static/177a87f2d7ae0fcc67c0d41424c92dab/29114/dive-screenshot.png 1920w"],sizes:"(max-width: 1200px) 100vw, 1200px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    ")),(0,i.kt)("p",null,"Thankfully it was a ",(0,i.kt)("inlineCode",{parentName:"p"},".parcel-cache")," that snuck into the image. Adding it to .dockerignore brought down the image size from 4 GB to 814 MB. This big drop made me write this."),(0,i.kt)("p",null,"Cherry on top : I realized that there's a ",(0,i.kt)("inlineCode",{parentName:"p"},"--production")," flag for npm install that removes devDependencies. This brought the size down to 358 MB."))}l.isMDXComponent=!0},63366:function(e,t,a){function n(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}a.d(t,{Z:function(){return n}})}}]);
//# sourceMappingURL=component---src-pages-logs-10-06-2023-inspecting-docker-images-mdx-29f6e510324b0ed8e19a.js.map